import{D as oe}from"./DetailsIcon-b7ac1f53.js";import{A as se,E as le,S as ne,a as ie,_ as de}from"./SLASection-de3d36dc.js";import{C as re}from"./CommentIcon-10341c79.js";import{P as me}from"./PhoneIcon-df7b879a.js";import{T as ue}from"./TaskIcon-c007a147.js";import{N as ce}from"./NoteModal-2036878e.js";import{W as _e}from"./WhatsAppIcon-60b0eaf1.js";import{I as pe}from"./IndicatorIcon-2e26ac17.js";import{O as fe}from"./OrganizationsIcon-b4d9134c.js";import{C as ve}from"./ContactsIcon-11a1459a.js";import{_ as be,a as ge}from"./LayoutHeader-d3ca6986.js";import{_ as xe}from"./AssignmentModal-8d3e4385.js";import{s as ye,_ as Ce}from"./statuses-cf7e371a.js";import{_ as F}from"./Link-00b86c9a.js";import{_ as we}from"./Section-b30b2258.js";import{_ as he}from"./CustomActions-3e5f5139.js";import{s as Ie,c as Ve,e as x}from"./index-12263c08.js";import{g as ke}from"./global-7d1669ca.js";import{c as Le}from"./contacts-d5d98e1c.js";import{o as Ae}from"./organizations-e15a7320.js";import{i as ze,c as De,w as Ue}from"./settings-01f42b9c.js";import{A as Ee,v as Se,x as S,a as $e,k as c,i as j,j as Ne,r as $,b as n,c as u,u as o,g as _,w as p,l as v,G as Me,e as d,d as i,F as q,I as N,n as P,f as Re,K as Te,t as y}from"./index-29a91f62.js";import{D as Oe}from"./Dropdown-a48e38bc.js";import{_ as W}from"./Switch.vue_vue_type_script_setup_true_lang-31eac77f.js";import{_ as Be}from"./Tabs-a1293733.js";import"./Email2Icon-90bca55a.js";import"./CalendarIcon-bb881b97.js";import"./callLog-1e378f99.js";import"./Dropdown-a2a4924b.js";import"./FadedScrollableDiv-9ed81c90.js";import"./FileUploader-ae370410.js";import"./LeadsIcon-aaabb1a8.js";import"./DealsIcon-c7294f54.js";import"./EmailTemplateModal-220c8442.js";import"./TaskModal-4a70befb.js";import"./ArrowUpRightIcon-b156aad4.js";import"./label-0b0a7961.js";const Fe={class:"relative flex h-12 items-center justify-between gap-2 py-2.5 pl-5"},je={class:"absolute right-0"},qe={key:1,class:"flex h-12 items-center justify-between gap-2 border-b px-3 py-2.5"},Pe={class:"flex items-center gap-2"},We={key:2,class:"flex h-full overflow-hidden"},Ge={key:0},Ke={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},He={class:"flex flex-col overflow-y-auto"},Je={class:"mb-4 flex items-center gap-2 text-gray-600"},Qe={class:"block text-base"},Xe={class:"ml-6"},Ye={class:"flex items-center justify-between text-base"},Ze={key:1,class:"mt-2.5 text-base"},ea={class:"mb-4 mt-6 flex items-center gap-2 text-gray-600"},aa={class:"block text-base"},ta={class:"ml-6"},oa={class:"flex items-center justify-between text-base"},sa={key:1,class:"mt-2.5 text-base"},ja={__name:"MobileLead",props:{leadId:{type:String,required:!0}},setup(G){const{$dialog:K}=ke(),{getContactByName:C,contacts:H}=Le(),{organizations:J}=Ae(),{statusOptions:Q,getLeadStatus:X}=ye(),M=Ee(),z=Se(),w=G,a=S({url:"crm.fcrm.doctype.crm_lead.api.get_lead",params:{name:w.leadId},cache:["lead",w.leadId],onSuccess:t=>{Ie(t),Ve(t,{doc:t,$dialog:K,router:z,updateField:k,createToast:x,deleteDoc:ee,call:N})}});$e(()=>{a.data||a.fetch()});const D=c(!1),V=c(!1);function R(t,e,l){e=Array.isArray(t)?"":e,!(!Array.isArray(t)&&Y(t,e))&&S({url:"frappe.client.set_value",params:{doctype:"CRM Lead",name:w.leadId,fieldname:t,value:e},auto:!0,onSuccess:()=>{a.reload(),D.value=!0,x({title:__("Lead updated"),icon:"check",iconClasses:"text-green-600"}),l==null||l()},onError:f=>{var A;x({title:__("Error updating lead"),text:__((A=f.messages)==null?void 0:A[0]),icon:"x",iconClasses:"text-red-600"})}})}function Y(t,e){var f;let l=a.data.fields_meta||{};return(f=l[t])!=null&&f.reqd&&!e?(x({title:__("Error Updating Lead"),text:__("{0} is a required field",[l[t].label]),icon:"x",iconClasses:"text-red-600"}),!0):!1}const Z=j(()=>{let t=[{label:__("Leads"),route:{name:"Leads"}}];return t.push({label:a.data.lead_name||__("Untitled"),route:{name:"Lead",params:{leadId:a.data.name}}}),t}),h=c(0),U=j(()=>[{name:"Details",label:__("Details"),icon:oe,condition:()=>ze.value},{name:"Activity",label:__("Activity"),icon:se},{name:"Emails",label:__("Emails"),icon:le},{name:"Comments",label:__("Comments"),icon:re},{name:"Calls",label:__("Calls"),icon:me,condition:()=>De.value},{name:"Tasks",label:__("Tasks"),icon:ue},{name:"Notes",label:__("Notes"),icon:ce},{name:"WhatsApp",label:__("WhatsApp"),icon:_e,condition:()=>Ue.value}].filter(e=>e.condition?e.condition():!0));Ne(U,t=>{if(t&&M.params.tabName){let e=t.findIndex(l=>l.name.toLowerCase()===M.params.tabName.toLowerCase());e!==-1&&(h.value=e)}});const E=S({url:"new_i.api.doc.get_sidebar_fields",cache:["fieldsLayout",w.leadId],params:{doctype:"CRM Lead",name:w.leadId},auto:!0});function k(t,e,l){R(t,e,()=>{a.data[t]=e,l==null||l()})}async function ee(t){await N("frappe.client.delete",{doctype:"CRM Lead",name:t}),z.push({name:"Leads"})}const L=c(!1),b=c(!1),g=c(!1),m=c(""),I=c("");async function T(t){let e=!1;if(b.value&&!m.value){x({title:__("Error"),text:__("Please select an existing contact"),icon:"x",iconClasses:"text-red-600"});return}if(g.value&&!I.value){x({title:__("Error"),text:__("Please select an existing organization"),icon:"x",iconClasses:"text-red-600"});return}if(b.value&&m.value&&(a.data.salutation=C(m.value).salutation,a.data.first_name=C(m.value).first_name,a.data.last_name=C(m.value).last_name,a.data.email_id=C(m.value).email_id,a.data.mobile_no=C(m.value).mobile_no,b.value=!1,e=!0),g.value&&I.value&&(a.data.organization=I.value,g.value=!1,e=!0),e)R({salutation:a.data.salutation,first_name:a.data.first_name,last_name:a.data.last_name,email_id:a.data.email_id,mobile_no:a.data.mobile_no,organization:a.data.organization},"",()=>T(!0)),L.value=!1;else{let l=await N("crm.fcrm.doctype.crm_lead.crm_lead.convert_to_deal",{lead:a.data.name});l&&(t&&(await J.reload(),await H.reload()),z.push({name:"Deal",params:{dealId:l}}))}}return(t,e)=>{var O,B;const l=$("FeatherIcon"),f=$("Button"),A=$("Dialog");return n(),u(q,null,[o(a).data?(n(),_(be,{key:0},{default:p(()=>[d("header",Fe,[i(o(ge),{items:Z.value},null,8,["items"]),d("div",je,[i(o(Oe),{options:o(Q)("lead",k)},{default:p(({open:s})=>[i(f,{label:o(a).data.status,class:P(o(X)(o(a).data.status).colorClass)},{prefix:p(()=>[i(pe)]),suffix:p(()=>[i(l,{name:s?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label","class"])]),_:1},8,["options"])])])]),_:1})):v("",!0),o(a).data?(n(),u("div",qe,[(n(),_(Me(((O=o(a).data._assignedTo)==null?void 0:O.length)==1?"Button":"div"),null,{default:p(()=>[i(Ce,{avatars:o(a).data._assignedTo,onClick:e[0]||(e[0]=s=>V.value=!0)},null,8,["avatars"])]),_:1})),d("div",Pe,[o(a).data._customActions?(n(),_(he,{key:0,actions:o(a).data._customActions},null,8,["actions"])):v("",!0),i(f,{label:t.__("Convert"),variant:"solid",onClick:e[1]||(e[1]=s=>L.value=!0)},null,8,["label"])])])):v("",!0),(B=o(a))!=null&&B.data?(n(),u("div",We,[i(o(Be),{modelValue:h.value,"onUpdate:modelValue":e[7]||(e[7]=s=>h.value=s),tabs:U.value,tablistClass:"!px-3",class:"overflow-auto"},{default:p(({tab:s})=>[s.name=="Details"?(n(),u("div",Ge,[o(a).data.sla_status?(n(),_(ne,{key:0,modelValue:o(a).data,"onUpdate:modelValue":e[2]||(e[2]=r=>o(a).data=r),onUpdateField:k},null,8,["modelValue"])):v("",!0),o(E).data?(n(),u("div",Ke,[d("div",He,[(n(!0),u(q,null,Re(o(E).data,(r,ae)=>(n(),u("div",{key:r.label,class:P(["flex flex-col px-2 py-3 sm:p-3",{"border-b":ae!==o(E).data.length-1}])},[i(we,{"is-opened":r.opened,label:r.label},{default:p(()=>[i(ie,{fields:r.fields,modelValue:o(a).data,"onUpdate:modelValue":e[3]||(e[3]=te=>o(a).data=te),onUpdate:k},null,8,["fields","modelValue"])]),_:2},1032,["is-opened","label"])],2))),128))])])):v("",!0)])):(n(),_(de,{key:1,doctype:"CRM Lead",title:s.name,tabs:U.value,reload:D.value,"onUpdate:reload":e[4]||(e[4]=r=>D.value=r),tabIndex:h.value,"onUpdate:tabIndex":e[5]||(e[5]=r=>h.value=r),modelValue:o(a),"onUpdate:modelValue":e[6]||(e[6]=r=>Te(a)?a.value=r:null)},null,8,["title","tabs","reload","tabIndex","modelValue"]))]),_:1},8,["modelValue","tabs"])])):v("",!0),V.value?(n(),_(xe,{key:3,modelValue:V.value,"onUpdate:modelValue":e[8]||(e[8]=s=>V.value=s),assignees:o(a).data._assignedTo,"onUpdate:assignees":e[9]||(e[9]=s=>o(a).data._assignedTo=s),doc:o(a).data,doctype:"CRM Lead"},null,8,["modelValue","assignees","doc"])):v("",!0),i(A,{modelValue:L.value,"onUpdate:modelValue":e[14]||(e[14]=s=>L.value=s),options:{title:t.__("Convert to Deal"),size:"xl",actions:[{label:t.__("Convert"),variant:"solid",onClick:T}]}},{"body-content":p(()=>[d("div",Je,[i(fe,{class:"h-4 w-4"}),d("label",Qe,y(t.__("Organization")),1)]),d("div",Xe,[d("div",Ye,[d("div",null,y(t.__("Choose Existing")),1),i(o(W),{modelValue:g.value,"onUpdate:modelValue":e[10]||(e[10]=s=>g.value=s)},null,8,["modelValue"])]),g.value?(n(),_(F,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:I.value,doctype:"CRM Organization",onChange:e[11]||(e[11]=s=>I.value=s)},null,8,["value"])):(n(),u("div",Ze,y(t.__("New organization will be created based on the data in details section")),1))]),d("div",ea,[i(ve,{class:"h-4 w-4"}),d("label",aa,y(t.__("Contact")),1)]),d("div",ta,[d("div",oa,[d("div",null,y(t.__("Choose Existing")),1),i(o(W),{modelValue:b.value,"onUpdate:modelValue":e[12]||(e[12]=s=>b.value=s)},null,8,["modelValue"])]),b.value?(n(),_(F,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:m.value,doctype:"Contact",onChange:e[13]||(e[13]=s=>m.value=s)},null,8,["value"])):(n(),u("div",sa,y(t.__("New contact will be created based on the person's details")),1))])]),_:1},8,["modelValue","options"])],64)}}};export{ja as default};
//# sourceMappingURL=MobileLead-49b0779c.js.map
