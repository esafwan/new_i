import{i as S,j as $,_ as O,n as z}from"./index-12263c08.js";import{A as L}from"./ArrowUpRightIcon-b156aad4.js";import{a as h,_ as P}from"./global-7d1669ca.js";import{T as J,_ as N,D as A}from"./Link-00b86c9a.js";import{_ as E,m as b,h as w,v as q,q as F,k as _,a as G,j as H,r as v,b as T,g as x,w as o,e as r,t as f,d as l,l as K,u as i,I as M,z as Q}from"./index-29a91f62.js";import{D}from"./Dropdown-a48e38bc.js";const W={class:"flex items-center gap-3"},X={class:"text-2xl font-semibold leading-6 text-gray-900"},Y={class:"flex flex-col gap-4"},Z={class:"mb-1.5 text-sm text-gray-600"},ee={class:"mb-1.5 text-sm text-gray-600"},ae={class:"flex flex-wrap items-center gap-2"},te={class:"cursor-pointer"},se={__name:"TaskModal",props:b({task:{type:Object,default:{}},doctype:{type:String,default:"CRM Lead"},doc:{type:String,default:""}},{modelValue:{},modelModifiers:{},reloadTasks:{},reloadTasksModifiers:{}}),emits:b(["updateTask"],["update:modelValue","update:reloadTasks"]),setup(u,{emit:le}){const d=u,c=w(u,"modelValue"),y=w(u,"reloadTasks"),C=q(),{getUser:m}=F(),k=_(null),p=_(!1),a=_({title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low",reference_doctype:d.doctype,reference_docname:null});function V(e){a.value.status=e}function I(e){a.value.priority=e}function R(){var n;if(!((n=d.task)!=null&&n.reference_docname))return;let e=d.task.reference_doctype=="CRM Deal"?"Deal":"Lead",t={leadId:d.task.reference_docname};e=="Deal"&&(t={dealId:d.task.reference_docname}),C.push({name:e,params:t})}async function U(){a.value.assigned_to||(a.value.assigned_to=m().name),a.value.name?(await M("frappe.client.set_value",{doctype:"CRM Task",name:a.value.name,fieldname:a.value})).name&&y.value.reload():(await M("frappe.client.insert",{doc:{doctype:"CRM Task",reference_doctype:d.doctype,reference_docname:d.doc||null,...a.value}})).name&&y.value.reload(),c.value=!1}function g(){p.value=!1,Q(()=>{var e,t,n;(n=(t=(e=k.value)==null?void 0:e.el)==null?void 0:t.focus)==null||n.call(t),a.value={...d.task},a.value.title&&(p.value=!0)})}return G(()=>c.value&&g()),H(c,e=>{e&&g()}),(e,t)=>{const n=v("Button"),j=v("TextInput"),B=v("Dialog");return T(),x(B,{modelValue:c.value,"onUpdate:modelValue":t[5]||(t[5]=s=>c.value=s),options:{size:"xl",actions:[{label:p.value?e.__("Update"):e.__("Create"),variant:"solid",onClick:()=>U()}]}},{"body-title":o(()=>{var s;return[r("div",W,[r("h3",X,f(p.value?e.__("Edit Task"):e.__("Create Task")),1),(s=u.task)!=null&&s.reference_docname?(T(),x(n,{key:0,variant:"outline",size:"sm",label:u.task.reference_doctype=="CRM Deal"?e.__("Open Deal"):e.__("Open Lead"),onClick:t[0]||(t[0]=oe=>R())},{suffix:o(()=>[l(L,{class:"h-4 w-4"})]),_:1},8,["label"])):K("",!0)])]}),"body-content":o(()=>[r("div",Y,[r("div",null,[r("div",Z,f(e.__("Title")),1),l(j,{ref_key:"title",ref:k,variant:"outline",modelValue:a.value.title,"onUpdate:modelValue":t[1]||(t[1]=s=>a.value.title=s),placeholder:e.__("Call with John Doe")},null,8,["modelValue","placeholder"])]),r("div",null,[r("div",ee,f(e.__("Description")),1),l(i(J),{variant:"outline",ref:"description","editor-class":"!prose-sm overflow-auto min-h-[80px] max-h-80 py-1.5 px-2 rounded border border-gray-300 bg-white hover:border-gray-400 hover:shadow-sm focus:bg-white focus:border-gray-500 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-gray-400 text-gray-800 transition-colors",bubbleMenu:!0,content:a.value.description,onChange:t[2]||(t[2]=s=>a.value.description=s),placeholder:e.__("Took a call with John Doe and discussed the new project.")},null,8,["content","placeholder"])]),r("div",ae,[l(i(D),{options:i($)(V)},{default:o(()=>[l(n,{label:a.value.status,class:"w-full justify-between"},{prefix:o(()=>[l(S,{status:a.value.status},null,8,["status"])]),_:1},8,["label"])]),_:1},8,["options"]),l(N,{class:"form-control",value:i(m)(a.value.assigned_to).full_name,doctype:"User",onChange:t[3]||(t[3]=s=>a.value.assigned_to=s),placeholder:e.__("John Doe"),hideMe:!0},{prefix:o(()=>[l(h,{class:"mr-2 !h-4 !w-4",user:a.value.assigned_to},null,8,["user"])]),"item-prefix":o(({option:s})=>[l(h,{class:"mr-2",user:s.value,size:"sm"},null,8,["user"])]),"item-label":o(({option:s})=>[l(i(P),{text:s.value},{default:o(()=>[r("div",te,f(i(m)(s.value).full_name),1)]),_:2},1032,["text"])]),_:1},8,["value","placeholder"]),l(i(A),{class:"datepicker w-36",modelValue:a.value.due_date,"onUpdate:modelValue":t[4]||(t[4]=s=>a.value.due_date=s),placeholder:e.__("01/04/2024 11:30 PM"),"input-class":"border-none"},null,8,["modelValue","placeholder"]),l(i(D),{options:i(z)(I)},{default:o(()=>[l(n,{label:a.value.priority,class:"w-full justify-between"},{prefix:o(()=>[l(O,{priority:a.value.priority},null,8,["priority"])]),_:1},8,["label"])]),_:1},8,["options"])])])]),_:1},8,["modelValue","options"])}}},pe=E(se,[["__scopeId","data-v-f6ad3d79"]]);export{pe as T};
//# sourceMappingURL=TaskModal-4a70befb.js.map
