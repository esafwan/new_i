import{_ as pe,a as fe,L as ve}from"./SidePanelModal-277153d8.js";import{E as ge}from"./EditIcon-94a66fee.js";import{A as be,E as Ce,_ as xe,S as ye,a as we}from"./SLASection-de3d36dc.js";import{E as he}from"./Email2Icon-90bca55a.js";import{C as ke}from"./CommentIcon-10341c79.js";import{P as W}from"./PhoneIcon-df7b879a.js";import{T as Ie}from"./TaskIcon-c007a147.js";import{N as Ve}from"./NoteModal-2036878e.js";import{W as Le}from"./WhatsAppIcon-60b0eaf1.js";import{I as Ee}from"./IndicatorIcon-2e26ac17.js";import{C as ze}from"./CameraIcon-59068c83.js";import{O as Ue}from"./OrganizationsIcon-b4d9134c.js";import{C as $e}from"./ContactsIcon-11a1459a.js";import{_ as Ae,a as Se}from"./LayoutHeader-d3ca6986.js";import{_ as Ne}from"./AssignmentModal-8d3e4385.js";import{s as Me,_ as De}from"./statuses-cf7e371a.js";import{_ as G}from"./Link-00b86c9a.js";import{_ as Re}from"./Section-b30b2258.js";import{_ as Te}from"./CustomActions-3e5f5139.js";import{s as Be,c as Fe,e as y,g as Oe,h as R,o as je}from"./index-12263c08.js";import{g as Pe,b as qe,_ as $}from"./global-7d1669ca.js";import{c as We}from"./contacts-d5d98e1c.js";import{o as Ge}from"./organizations-e15a7320.js";import{q as Je,A as Ke,v as He,x as T,a as Qe,k as c,i as J,j as Xe,r as A,b as r,c as g,u as a,g as _,w as n,l as f,d as l,F as K,I as B,G as H,n as Q,K as Ye,e as i,t as v,C as Ze,f as ea,E as aa}from"./index-29a91f62.js";import{c as X,w as ta}from"./settings-01f42b9c.js";import{D as Y}from"./Dropdown-a48e38bc.js";import{F as oa}from"./FileUploader-ae370410.js";import{_ as Z}from"./Switch.vue_vue_type_script_setup_true_lang-31eac77f.js";import{_ as sa}from"./Tabs-a1293733.js";import"./DragVerticalIcon-2de8ea46.js";import"./CalendarIcon-bb881b97.js";import"./callLog-1e378f99.js";import"./Dropdown-a2a4924b.js";import"./FadedScrollableDiv-9ed81c90.js";import"./LeadsIcon-aaabb1a8.js";import"./DealsIcon-c7294f54.js";import"./EmailTemplateModal-220c8442.js";import"./TaskModal-4a70befb.js";import"./ArrowUpRightIcon-b156aad4.js";import"./label-0b0a7961.js";const la={key:1,class:"flex h-full overflow-hidden"},na={class:"flex items-center justify-start gap-5 border-b p-5"},ia={class:"group relative size-12"},da={class:"z-1 absolute bottom-0.5 left-0 right-0.5 flex h-9 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-3 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(12px 0 0 0)","clip-path":"inset(12px 0 0 0)"}},ra={class:"flex flex-col gap-2.5 truncate"},ma={class:"truncate text-2xl font-medium"},ua={class:"flex gap-1.5"},ca={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},_a={class:"flex flex-col overflow-y-auto"},pa={class:"mb-4 flex items-center gap-2 text-gray-600"},fa={class:"block text-base"},va={class:"ml-6"},ga={class:"flex items-center justify-between text-base"},ba={key:1,class:"mt-2.5 text-base"},Ca={class:"mb-4 mt-6 flex items-center gap-2 text-gray-600"},xa={class:"block text-base"},ya={class:"ml-6"},wa={class:"flex items-center justify-between text-base"},ha={key:1,class:"mt-2.5 text-base"},mt={__name:"Lead",props:{leadId:{type:String,required:!0}},setup(ee){const{$dialog:ae,makeCall:te}=Pe(),{getContactByName:w,contacts:oe}=We(),{organizations:se}=Ge(),{statusOptions:le,getLeadStatus:ne}=Me(),{isManager:ie}=Je(),F=Ke(),S=He(),h=ee,t=T({url:"crm.fcrm.doctype.crm_lead.api.get_lead",params:{name:h.leadId},cache:["lead",h.leadId],onSuccess:o=>{Be(o),Fe(o,{doc:o,$dialog:ae,router:S,updateField:b,createToast:y,deleteDoc:ue,call:B})}});Qe(()=>{t.data||t.fetch()});const N=c(!1),V=c(!1),L=c(!1);function O(o,e,d){e=Array.isArray(o)?"":e,!(!Array.isArray(o)&&de(o,e))&&T({url:"frappe.client.set_value",params:{doctype:"CRM Lead",name:h.leadId,fieldname:o,value:e},auto:!0,onSuccess:()=>{t.reload(),N.value=!0,y({title:__("Lead updated"),icon:"check",iconClasses:"text-green-600"}),d==null||d()},onError:u=>{var z;y({title:__("Error updating lead"),text:__((z=u.messages)==null?void 0:z[0]),icon:"x",iconClasses:"text-red-600"})}})}function de(o,e){var u;let d=t.data.fields_meta||{};return(u=d[o])!=null&&u.reqd&&!e?(y({title:__("Error Updating Lead"),text:__("{0} is a required field",[d[o].label]),icon:"x",iconClasses:"text-red-600"}),!0):!1}const re=J(()=>{let o=[{label:__("Leads"),route:{name:"Leads"}}];return o.push({label:t.data.lead_name||__("Untitled"),route:{name:"Lead",params:{leadId:t.data.name}}}),o}),k=c(0),M=J(()=>[{name:"Activity",label:__("Activity"),icon:be},{name:"Emails",label:__("Emails"),icon:Ce},{name:"Comments",label:__("Comments"),icon:ke},{name:"Calls",label:__("Calls"),icon:W,condition:()=>X.value},{name:"Tasks",label:__("Tasks"),icon:Ie},{name:"Notes",label:__("Notes"),icon:Ve},{name:"WhatsApp",label:__("WhatsApp"),icon:Le,condition:()=>ta.value}].filter(e=>e.condition?e.condition():!0));Xe(M,o=>{if(o&&F.params.tabName){let e=o.findIndex(d=>d.name.toLowerCase()===F.params.tabName.toLowerCase());e!==-1&&(k.value=e)}});function me(o){let e=o.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(e))return __("Only PNG and JPG images are allowed")}const D=T({url:"new_i.api.doc.get_sidebar_fields",cache:["fieldsLayout",h.leadId],params:{doctype:"CRM Lead",name:h.leadId},auto:!0});function b(o,e,d){O(o,e,()=>{t.data[o]=e,d==null||d()})}async function ue(o){await B("frappe.client.delete",{doctype:"CRM Lead",name:o}),S.push({name:"Leads"})}const E=c(!1),C=c(!1),x=c(!1),p=c(""),I=c("");async function j(o){let e=!1;if(C.value&&!p.value){y({title:__("Error"),text:__("Please select an existing contact"),icon:"x",iconClasses:"text-red-600"});return}if(x.value&&!I.value){y({title:__("Error"),text:__("Please select an existing organization"),icon:"x",iconClasses:"text-red-600"});return}if(C.value&&p.value&&(t.data.salutation=w(p.value).salutation,t.data.first_name=w(p.value).first_name,t.data.last_name=w(p.value).last_name,t.data.email_id=w(p.value).email_id,t.data.mobile_no=w(p.value).mobile_no,C.value=!1,e=!0),x.value&&I.value&&(t.data.organization=I.value,x.value=!1,e=!0),e)O({salutation:t.data.salutation,first_name:t.data.first_name,last_name:t.data.last_name,email_id:t.data.email_id,mobile_no:t.data.mobile_no,organization:t.data.organization},"",()=>j(!0)),E.value=!1;else{let d=await B("crm.fcrm.doctype.crm_lead.crm_lead.convert_to_deal",{lead:t.data.name});d&&(o&&(await se.reload(),await oe.reload()),S.push({name:"Deal",params:{dealId:d}}))}}const P=c(null);function ce(){P.value.emailBox.show=!0}return(o,e)=>{var q;const d=A("FeatherIcon"),u=A("Button"),z=A("ErrorMessage"),_e=A("Dialog");return r(),g(K,null,[a(t).data?(r(),_(Ae,{key:0},{"left-header":n(()=>[l(a(Se),{items:re.value},null,8,["items"])]),"right-header":n(()=>{var s;return[a(t).data._customActions?(r(),_(Te,{key:0,actions:a(t).data._customActions},null,8,["actions"])):f("",!0),(r(),_(H(((s=a(t).data._assignedTo)==null?void 0:s.length)==1?"Button":"div"),null,{default:n(()=>[l(De,{avatars:a(t).data._assignedTo,onClick:e[0]||(e[0]=m=>V.value=!0)},null,8,["avatars"])]),_:1})),l(a(Y),{options:a(le)("lead",b)},{default:n(({open:m})=>[l(u,{label:a(t).data.status,class:Q(a(ne)(a(t).data.status).colorClass)},{prefix:n(()=>[l(Ee)]),suffix:n(()=>[l(d,{name:m?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label","class"])]),_:1},8,["options"]),l(u,{label:o.__("Convert to Deal"),variant:"solid",onClick:e[1]||(e[1]=m=>E.value=!0)},null,8,["label"])]}),_:1})):f("",!0),(q=a(t))!=null&&q.data?(r(),g("div",la,[l(a(sa),{modelValue:k.value,"onUpdate:modelValue":e[5]||(e[5]=s=>k.value=s),tabs:M.value},{default:n(({tab:s})=>[l(xe,{ref_key:"activities",ref:P,doctype:"CRM Lead",title:s.name,tabs:M.value,reload:N.value,"onUpdate:reload":e[2]||(e[2]=m=>N.value=m),tabIndex:k.value,"onUpdate:tabIndex":e[3]||(e[3]=m=>k.value=m),modelValue:a(t),"onUpdate:modelValue":e[4]||(e[4]=m=>Ye(t)?t.value=m:null)},null,8,["title","tabs","reload","tabIndex","modelValue"])]),_:1},8,["modelValue","tabs"]),l(pe,{class:"flex flex-col justify-between border-l",side:"right"},{default:n(()=>[i("div",{class:"flex h-10.5 cursor-copy items-center border-b px-5 py-2.5 text-lg font-medium",onClick:e[6]||(e[6]=s=>a(Oe)(a(t).data.name))},v(o.__(a(t).data.name)),1),l(a(oa),{onSuccess:e[10]||(e[10]=s=>b("image",s.file_url)),validateFile:me},{default:n(({openFileSelector:s,error:m})=>[i("div",na,[i("div",ia,[l(a(qe),{size:"3xl",class:"size-12",label:a(t).data.first_name||o.__("Untitled"),image:a(t).data.image},null,8,["label","image"]),(r(),_(H(a(t).data.image?a(Y):"div"),Ze(a(t).data.image?{options:[{icon:"upload",label:a(t).data.image?o.__("Change image"):o.__("Upload image"),onClick:s},{icon:"trash-2",label:o.__("Remove image"),onClick:()=>b("image","")}]}:{onClick:s},{class:"!absolute bottom-0 left-0 right-0"}),{default:n(()=>[i("div",da,[l(ze,{class:"size-4 cursor-pointer text-white"})])]),_:2},1040))]),i("div",ra,[l(a($),{text:a(t).data.lead_name||o.__("Set first name")},{default:n(()=>[i("div",ma,v(a(t).data.lead_name||o.__("Untitled")),1)]),_:1},8,["text"]),i("div",ua,[a(X)?(r(),_(a($),{key:0,text:o.__("Make a call")},{default:n(()=>[l(u,{class:"h-7 w-7",onClick:e[7]||(e[7]=()=>a(t).data.mobile_no?a(te)(a(t).data.mobile_no):a(R)(o.__("No phone number set")))},{default:n(()=>[l(W,{class:"h-4 w-4"})]),_:1})]),_:1},8,["text"])):f("",!0),l(a($),{text:o.__("Send an email")},{default:n(()=>[l(u,{class:"h-7 w-7"},{default:n(()=>[l(he,{class:"h-4 w-4",onClick:e[8]||(e[8]=U=>a(t).data.email?ce():a(R)(o.__("No email set")))})]),_:1})]),_:1},8,["text"]),l(a($),{text:o.__("Go to website")},{default:n(()=>[l(u,{class:"h-7 w-7"},{default:n(()=>[l(ve,{class:"h-4 w-4",onClick:e[9]||(e[9]=U=>a(t).data.website?a(je)(a(t).data.website):a(R)(o.__("No website set")))})]),_:1})]),_:1},8,["text"])]),l(z,{message:o.__(m)},null,8,["message"])])])]),_:1}),a(t).data.sla_status?(r(),_(ye,{key:0,modelValue:a(t).data,"onUpdate:modelValue":e[11]||(e[11]=s=>a(t).data=s),onUpdateField:b},null,8,["modelValue"])):f("",!0),a(D).data?(r(),g("div",ca,[i("div",_a,[(r(!0),g(K,null,ea(a(D).data,(s,m)=>(r(),g("div",{key:s.label,class:Q(["flex flex-col p-3",{"border-b":m!==a(D).data.length-1}])},[l(Re,{"is-opened":s.opened,label:s.label},aa({default:n(()=>[l(we,{fields:s.fields,modelValue:a(t).data,"onUpdate:modelValue":e[12]||(e[12]=U=>a(t).data=U),onUpdate:b},null,8,["fields","modelValue"])]),_:2},[m==0&&a(ie)()?{name:"actions",fn:n(()=>[l(u,{variant:"ghost",class:"w-7 mr-2",onClick:e[13]||(e[13]=U=>L.value=!0)},{default:n(()=>[l(ge,{class:"h-4 w-4"})]),_:1})]),key:"0"}:void 0]),1032,["is-opened","label"])],2))),128))])])):f("",!0)]),_:1})])):f("",!0),V.value?(r(),_(Ne,{key:2,modelValue:V.value,"onUpdate:modelValue":e[14]||(e[14]=s=>V.value=s),assignees:a(t).data._assignedTo,"onUpdate:assignees":e[15]||(e[15]=s=>a(t).data._assignedTo=s),doc:a(t).data,doctype:"CRM Lead"},null,8,["modelValue","assignees","doc"])):f("",!0),l(_e,{modelValue:E.value,"onUpdate:modelValue":e[20]||(e[20]=s=>E.value=s),options:{title:o.__("Convert to Deal"),size:"xl",actions:[{label:o.__("Convert"),variant:"solid",onClick:j}]}},{"body-content":n(()=>[i("div",pa,[l(Ue,{class:"h-4 w-4"}),i("label",fa,v(o.__("Organization")),1)]),i("div",va,[i("div",ga,[i("div",null,v(o.__("Choose Existing")),1),l(a(Z),{modelValue:x.value,"onUpdate:modelValue":e[16]||(e[16]=s=>x.value=s)},null,8,["modelValue"])]),x.value?(r(),_(G,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:I.value,doctype:"CRM Organization",onChange:e[17]||(e[17]=s=>I.value=s)},null,8,["value"])):(r(),g("div",ba,v(o.__("New organization will be created based on the data in details section")),1))]),i("div",Ca,[l($e,{class:"h-4 w-4"}),i("label",xa,v(o.__("Contact")),1)]),i("div",ya,[i("div",wa,[i("div",null,v(o.__("Choose Existing")),1),l(a(Z),{modelValue:C.value,"onUpdate:modelValue":e[18]||(e[18]=s=>C.value=s)},null,8,["modelValue"])]),C.value?(r(),_(G,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:p.value,doctype:"Contact",onChange:e[19]||(e[19]=s=>p.value=s)},null,8,["value"])):(r(),g("div",ha,v(o.__("New contact will be created based on the person's details")),1))])]),_:1},8,["modelValue","options"]),L.value?(r(),_(fe,{key:3,modelValue:L.value,"onUpdate:modelValue":e[21]||(e[21]=s=>L.value=s)},null,8,["modelValue"])):f("",!0)],64)}}};export{mt as default};
//# sourceMappingURL=Lead-4b5e1292.js.map
