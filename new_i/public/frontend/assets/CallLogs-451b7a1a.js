import{_ as O}from"./CustomActions-3e5f5139.js";import{P as G}from"./PhoneIcon-df7b879a.js";import{_ as K,a as Q}from"./LayoutHeader-d3ca6986.js";import{_ as X}from"./ViewControls-ed2bb842.js";import{m as N,h as P,i as B,s as Y,j as E,k,r as U,b as a,c as u,d as r,w as d,u as _,F as I,f as T,g as b,n as z,l as L,e as f,t as V,p as ee,C as le,_ as Z,v as oe,B as S,D as R,E as te,G as ae,H as ne,I as se,J as W}from"./index-29a91f62.js";import{_ as re,H as j,a as ie,f as ue,b as ce,g as de,c as me,d as pe,e as ve}from"./ListBulkActions-8ddaba3b.js";import{b as H,_ as q}from"./global-7d1669ca.js";import{D as _e}from"./Dropdown-a48e38bc.js";import{_ as fe}from"./ListFooter-96a0f786.js";import{A as ge}from"./ArrowUpRightIcon-b156aad4.js";import{D as Ce,g as J}from"./callLog-1e378f99.js";import{C as ye}from"./ContactsIcon-11a1459a.js";import{L as ke}from"./LeadsIcon-aaabb1a8.js";import{D as he}from"./DealsIcon-c7294f54.js";import{C as we}from"./CalendarIcon-bb881b97.js";import{N as be,_ as Le}from"./NoteModal-2036878e.js";import{_ as xe}from"./FadedScrollableDiv-9ed81c90.js";import"./settings-01f42b9c.js";import"./DetailsIcon-b7ac1f53.js";import"./Link-00b86c9a.js";import"./NestedPopover-620c36ca.js";import"./EditIcon-94a66fee.js";import"./views-f9b9afbd.js";import"./index-12263c08.js";import"./DragVerticalIcon-2de8ea46.js";import"./AssignmentModal-8d3e4385.js";import"./label-0b0a7961.js";import"./contacts-d5d98e1c.js";const $e={key:0},Ve={key:1},Me=["onClick"],De={key:1,class:"truncate text-base"},Fe={key:2},Ue={key:3},Ie=["onClick"],Ae={__name:"CallLogsListView",props:N({rows:{type:Array,required:!0},columns:{type:Array,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},{modelValue:{},modelModifiers:{},list:{},listModifiers:{}}),emits:N(["loadMore","updatePageCount","columnWidthUpdated","applyFilter","applyLikeFilter","likeDoc"],["update:modelValue","update:list"]),setup(c,{expose:M,emit:w}){const n=w,h=P(c,"modelValue"),C=P(c,"list"),i=B(()=>{var l,s;return!!((s=(l=C.value.params)==null?void 0:l.filters)!=null&&s._liked_by)}),{user:x}=Y();function D(l){if(l)return JSON.parse(l).includes(x)}E(h,(l,s)=>{l!==s&&n("updatePageCount",l)});const p=k(null);return M({customListActions:B(()=>{var l;return(l=p.value)==null?void 0:l.customListActions})}),(l,s)=>{const g=U("Button"),o=U("FeatherIcon"),t=U("Badge"),F=U("FormControl");return a(),u(I,null,[r(_(pe),le({columns:c.columns,rows:c.rows,options:{onRowClick:e=>n("showCallLog",e.name),selectable:c.options.selectable,showTooltip:c.options.showTooltip,resizeColumn:c.options.resizeColumn},"row-key":"name"},l.$attrs),{default:d(()=>[r(_(re),{class:"sm:mx-5 mx-3",onColumnWidthUpdated:s[1]||(s[1]=e=>n("columnWidthUpdated"))},{default:d(()=>[(a(!0),u(I,null,T(c.columns,e=>(a(),b(_(ie),{key:e.key,item:e,onColumnWidthUpdated:y=>n("columnWidthUpdated",e)},{default:d(()=>[e.key=="_liked_by"?(a(),b(g,{key:0,variant:"ghosted",class:z(["!h-4",i.value?"fill-red-500":"fill-white"]),onClick:s[0]||(s[0]=()=>n("applyLikeFilter"))},{default:d(()=>[r(j,{class:"h-4 w-4"})]),_:1},8,["class"])):L("",!0)]),_:2},1032,["item","onColumnWidthUpdated"]))),128))]),_:1}),r(_(ue),{class:"mx-3 sm:mx-5",id:"list-rows"},{default:d(()=>[(a(!0),u(I,null,T(c.rows,e=>(a(),b(_(de),{key:e.name,row:e},{default:d(({idx:y,column:v,item:m})=>[r(_(ce),{item:m},{prefix:d(()=>[["caller","receiver"].includes(v.key)?(a(),u("div",$e,[m.label?(a(),b(_(H),{key:0,class:"flex items-center",image:m.image,label:m.label,size:"sm"},null,8,["image","label"])):L("",!0)])):["type","duration"].includes(v.key)?(a(),u("div",Ve,[r(o,{name:m.icon,class:"h-3 w-3"},null,8,["name"])])):L("",!0)]),default:d(({label:A})=>[["modified","creation"].includes(v.key)?(a(),u("div",{key:0,class:"truncate text-base",onClick:$=>n("applyFilter",{event:$,idx:y,column:v,item:m,firstColumn:c.columns[0]})},[r(_(q),{text:m.label},{default:d(()=>[f("div",null,V(m.timeAgo),1)]),_:2},1032,["text"])],8,Me)):v.key==="status"?(a(),u("div",De,[r(t,{variant:"subtle",theme:m.color,size:"md",label:l.__(m.label),onClick:$=>n("applyFilter",{event:$,idx:y,column:v,item:m,firstColumn:c.columns[0]})},null,8,["theme","label","onClick"])])):v.type==="Check"?(a(),u("div",Fe,[r(F,{type:"checkbox",modelValue:m,disabled:!0,class:"text-gray-900"},null,8,["modelValue"])])):v.key==="_liked_by"?(a(),u("div",Ue,[v.key=="_liked_by"?(a(),b(g,{key:0,variant:"ghosted",class:z(D(m)?"fill-red-500":"fill-white"),onClick:ee(()=>n("likeDoc",{name:e.name,liked:D(m)}),["stop","prevent"])},{default:d(()=>[r(j,{class:"h-4 w-4"})]),_:2},1032,["class","onClick"])):L("",!0)])):(a(),u("div",{key:4,class:"truncate text-base",onClick:$=>n("applyFilter",{event:$,idx:y,column:v,item:m,firstColumn:c.columns[0]})},V(A),9,Ie))]),_:2},1032,["item"])]),_:2},1032,["row"]))),128))]),_:1}),r(_(me),null,{actions:d(({selections:e,unselectAll:y})=>[r(_(_e),{options:p.value.bulkActions(e,y)},{default:d(()=>[r(g,{icon:"more-horizontal",variant:"ghost"})]),_:2},1032,["options"])]),_:1})]),_:1},16,["columns","rows","options"]),r(_(fe),{class:"border-t sm:px-5 px-3 py-2",modelValue:h.value,"onUpdate:modelValue":s[2]||(s[2]=e=>h.value=e),options:{rowCount:c.options.rowCount,totalCount:c.options.totalCount},onLoadMore:s[3]||(s[3]=e=>n("loadMore"))},null,8,["modelValue","options"]),r(ve,{ref_key:"listBulkActionsRef",ref:p,modelValue:C.value,"onUpdate:modelValue":s[4]||(s[4]=e=>C.value=e),doctype:"CRM Call Log",options:{hideEdit:!0,hideAssign:!0}},null,8,["modelValue"])],64)}}},Be={},ze={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Re=f("g",{"clip-path":"url(#clip0_3668_69185)"},[f("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M14.25 8C14.25 11.4518 11.4518 14.25 8 14.25C4.54822 14.25 1.75 11.4518 1.75 8C1.75 4.54822 4.54822 1.75 8 1.75C11.4518 1.75 14.25 4.54822 14.25 8ZM15.25 8C15.25 12.0041 12.0041 15.25 8 15.25C3.99594 15.25 0.75 12.0041 0.75 8C0.75 3.99594 3.99594 0.75 8 0.75C12.0041 0.75 15.25 3.99594 15.25 8ZM11.2909 5.98482C11.4666 5.77175 11.4363 5.45663 11.2232 5.28096C11.0101 5.1053 10.695 5.13561 10.5193 5.34868L7.07001 9.53239L5.72845 7.79857C5.55946 7.58018 5.24543 7.54012 5.02703 7.70911C4.80863 7.8781 4.76858 8.19214 4.93756 8.41053L6.66217 10.6394C6.7552 10.7596 6.89788 10.831 7.04988 10.8334C7.20188 10.8357 7.3467 10.7688 7.4434 10.6515L11.2909 5.98482Z",fill:"currentColor"})],-1),Ne=f("defs",null,[f("clipPath",{id:"clip0_3668_69185"},[f("rect",{width:"16",height:"16",fill:"white"})])],-1),Pe=[Re,Ne];function Te(c,M){return a(),u("svg",ze,Pe)}const He=Z(Be,[["render",Te]]);const Se={class:"flex items-center gap-3"},We={class:"text-2xl font-semibold leading-6 text-gray-900"},je={class:"flex flex-col gap-3.5"},Ee={class:"grid size-7 place-content-center"},Ze={class:"flex min-h-7 w-full items-center gap-2"},qe={key:0,class:"flex items-center gap-1"},Je={class:"ml-1 flex flex-col gap-1"},Oe={class:"ml-1 flex flex-col gap-1"},Ge={key:2,class:"w-full"},Ke=["src"],Qe=["innerHTML"],Xe=["innerHTML"],Ye={key:5},el={__name:"CallLogModal",props:N({name:{type:String,default:{}}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(c){const M=c,w=P(c,"modelValue"),n=k(!1),h=oe(),C=k(null),i=k({}),x=B(()=>{var l;return i.value.doc?[{icon:S(R,{name:i.value.doc.type.icon,class:"h-3.5 w-3.5"}),name:"type",value:i.value.doc.type.label+" Call"},{icon:ye,name:"receiver",value:{receiver:i.value.doc.receiver,caller:i.value.doc.caller}},{icon:i.value.doc.reference_doctype=="CRM Lead"?ke:he,name:"reference_doctype",value:i.value.doc.reference_doctype=="CRM Lead"?"Lead":"Deal",link:()=>{i.value.doc.reference_doctype=="CRM Lead"?h.push({name:"Lead",params:{leadId:i.value.doc.reference_docname}}):h.push({name:"Deal",params:{dealId:i.value.doc.reference_docname}})},condition:()=>i.value.doc.reference_docname},{icon:we,name:"creation",value:i.value.doc.creation.label,tooltip:i.value.doc.creation.label},{icon:Ce,name:"duration",value:i.value.doc.duration.label},{icon:He,name:"status",value:i.value.doc.status.label,color:i.value.doc.status.color},{icon:S(R,{name:"play-circle",class:"h-4 w-4 mt-2"}),name:"recording_url",value:i.value.doc.recording_url},{icon:be,name:"note",value:(l=C.value)==null?void 0:l.doc}].filter(s=>s.value).filter(s=>s.condition?s.condition():!0):[]});function D(){se("crm.fcrm.doctype.crm_call_log.crm_call_log.create_lead_from_call_log",{call_log:i.value.doc}).then(p=>{p&&h.push({name:"Lead",params:{leadId:p}})})}return E(w,p=>{p&&(i.value=W({doctype:"CRM Call Log",name:M.name,fields:["name","caller","receiver","duration","type","status","from","to","note","recording_url","reference_doctype","reference_docname","creation"],cache:["call_log",M.name],auto:!0,transform:l=>{for(const s in l)l[s]=J(s,l);return l},onSuccess:l=>{if(!l.note){C.value=null;return}C.value=W({doctype:"FCRM Note",name:l.note,fields:["title","content"],cache:["note",l.note],auto:!0})}}))}),(p,l)=>{var o,t,F;const s=U("Button"),g=U("Dialog");return a(),u(I,null,[r(g,{modelValue:w.value,"onUpdate:modelValue":l[1]||(l[1]=e=>w.value=e)},te({"body-title":d(()=>[f("div",Se,[f("h3",We,V(p.__("Call Details")),1)])]),"body-content":d(()=>[f("div",je,[(a(!0),u(I,null,T(x.value,e=>(a(),u("div",{key:e.name,class:"flex gap-2 text-base text-gray-800"},[f("div",Ee,[(a(),b(ae(e.icon)))]),f("div",Ze,[e.name=="receiver"?(a(),u("div",qe,[r(_(H),{image:e.value.caller.image,label:e.value.caller.label,size:"sm"},null,8,["image","label"]),f("div",Je,V(e.value.caller.label),1),r(_(R),{name:"arrow-right",class:"mx-1 h-4 w-4 text-gray-600"}),r(_(H),{image:e.value.receiver.image,label:e.value.receiver.label,size:"sm"},null,8,["image","label"]),f("div",Oe,V(e.value.receiver.label),1)])):e.tooltip?(a(),b(_(q),{key:1,text:e.tooltip},{default:d(()=>[ne(V(e.value),1)]),_:2},1032,["text"])):e.name=="recording_url"?(a(),u("div",Ge,[f("audio",{class:"audio-control w-full",controls:"",src:e.value},null,8,Ke)])):e.name=="note"?(a(),u("div",{key:3,class:"w-full cursor-pointer rounded border px-2 pt-1.5 text-base text-gray-700",onClick:l[0]||(l[0]=()=>n.value=!0)},[r(xe,{class:"max-h-24 min-h-16 overflow-y-auto"},{default:d(()=>{var y,v,m,A,$;return[(y=e.value)!=null&&y.title?(a(),u("div",{key:0,class:z([(v=e.value)!=null&&v.content?"mb-1 font-bold":""]),innerHTML:(m=e.value)==null?void 0:m.title},null,10,Qe)):L("",!0),(A=e.value)!=null&&A.content?(a(),u("div",{key:1,innerHTML:($=e.value)==null?void 0:$.content},null,8,Xe)):L("",!0)]}),_:2},1024)])):(a(),u("div",{key:4,class:z(e.color?`text-${e.color}-600`:"")},V(e.value),3)),e.link?(a(),u("div",Ye,[r(ge,{class:"h-4 w-4 shrink-0 cursor-pointer text-gray-600 hover:text-gray-800",onClick:()=>e.link()},null,8,["onClick"])])):L("",!0)])]))),128))])]),_:2},[((o=i.value.doc)==null?void 0:o.type.label)=="Incoming"&&!((t=i.value.doc)!=null&&t.reference_docname)?{name:"actions",fn:d(()=>[r(s,{class:"w-full",variant:"solid",label:p.__("Create lead"),onClick:D},null,8,["label"])]),key:"0"}:void 0]),1032,["modelValue"]),r(Le,{modelValue:n.value,"onUpdate:modelValue":l[2]||(l[2]=e=>n.value=e),note:(F=C.value)==null?void 0:F.doc},null,8,["modelValue","note"])],64)}}},ll=Z(el,[["__scopeId","data-v-f1ebee8d"]]),ol={key:1,class:"flex h-full items-center justify-center"},tl={class:"flex flex-col items-center gap-3 text-xl font-medium text-gray-500"},Il={__name:"CallLogs",setup(c){const M=[{label:__("Call Logs"),route:{name:"Call Logs"}}],w=k(null),n=k({}),h=k(1),C=k(1),i=k(20),x=k(null),D=B(()=>{var g,o,t;return!((o=(g=n.value)==null?void 0:g.data)!=null&&o.data)||!["list","group_by"].includes(n.value.data.view_type)?[]:(t=n.value)==null?void 0:t.data.data.map(F=>{var y;let e={};return(y=n.value)==null||y.data.rows.forEach(v=>{e[v]=J(v,F)}),e})}),p=k(!1),l=k(null);function s(g){l.value=g,p.value=!0}return(g,o)=>(a(),u(I,null,[r(K,null,{"left-header":d(()=>[r(_(Q),{items:M})]),"right-header":d(()=>{var t;return[(t=w.value)!=null&&t.customListActions?(a(),b(O,{key:0,actions:w.value.customListActions},null,8,["actions"])):L("",!0)]}),_:1}),r(X,{ref_key:"viewControls",ref:x,modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=t=>n.value=t),loadMore:h.value,"onUpdate:loadMore":o[1]||(o[1]=t=>h.value=t),resizeColumn:C.value,"onUpdate:resizeColumn":o[2]||(o[2]=t=>C.value=t),updatedPageCount:i.value,"onUpdate:updatedPageCount":o[3]||(o[3]=t=>i.value=t),doctype:"CRM Call Log"},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount"]),n.value.data&&D.value.length?(a(),b(Ae,{key:0,ref_key:"callLogsListView",ref:w,modelValue:n.value.data.page_length_count,"onUpdate:modelValue":o[4]||(o[4]=t=>n.value.data.page_length_count=t),list:n.value,"onUpdate:list":o[5]||(o[5]=t=>n.value=t),rows:D.value,columns:n.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:n.value.data.row_count,totalCount:n.value.data.total_count},onShowCallLog:s,onLoadMore:o[6]||(o[6]=()=>h.value++),onColumnWidthUpdated:o[7]||(o[7]=()=>C.value++),onUpdatePageCount:o[8]||(o[8]=t=>i.value=t),onApplyFilter:o[9]||(o[9]=t=>x.value.applyFilter(t)),onApplyLikeFilter:o[10]||(o[10]=t=>x.value.applyLikeFilter(t)),onLikeDoc:o[11]||(o[11]=t=>x.value.likeDoc(t))},null,8,["modelValue","list","rows","columns","options"])):n.value.data?(a(),u("div",ol,[f("div",tl,[r(G,{class:"h-10 w-10"}),f("span",null,V(g.__("No {0} Found",[g.__("Logs")])),1)])])):L("",!0),r(ll,{modelValue:p.value,"onUpdate:modelValue":o[12]||(o[12]=t=>p.value=t),name:l.value},null,8,["modelValue","name"])],64))}};export{Il as default};
//# sourceMappingURL=CallLogs-451b7a1a.js.map
